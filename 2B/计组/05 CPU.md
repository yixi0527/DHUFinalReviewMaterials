# CPU的功能和组成

-   功能
    -   指令控制：程序是一个指令序列，需要保证机器按顺序执行程序。
    -   操作控制：一条指令的功能往往是由若干个操作信号的组合来实现的。因此，CPU管理并产生由内存取出的每条指令的操作信号，把各种操作信号送往相应的部件。
    -   时间控制：对各种操作实施时间上的定时。
    -   数据加工：对数据进行算术运算和逻辑运算处理。

-   组成
    -   控制器：程序计数器、指令寄存器、指令译码器、时序产生器和操作控制器
    -   运算器：算术逻辑单元ALU、通用寄存器、数据缓冲寄存器DR、程序状态字寄存器PSWR

# 指令周期

指令周期用若干个CPU周期数来表示，CPU周期又称机器周期。通常用内存中读取一个指令字的最短时间来规定CPU周期。（一条指令的取指需要一个CPU周期）。而一个CPU周期又包含若干个时钟周期（T周期/脉冲）。

![image-20240622104549786](./05%20CPU.assets/image-20240622104549786.png)

## 用方框图语言表示指令周期

![image-20240622104636075](./05%20CPU.assets/image-20240622104636075.png)

![image-20240622104642997](./05%20CPU.assets/image-20240622104642997.png)

# 时序产生器和控制方式

微程序控制器：节拍电位-节拍脉冲

- 控制方式：控制不同操作序列时序信号的方法。
    -   同步控制方式：任何情况下，已定的指令在执行所需的机器周期数和时钟周期数都是固定不变的。
    -   异步控制方式：每条指令、每个操作控制信号需要多少时间就占用多少时间。
    -   联合控制方式：大部分操作序列安排在固定的机器周期中，对于某些时间难以确定的操作，则以执行部件的“回答”作为本次操作的结束标志。

# 微程序控制器

控制部件通过控制线向执行部件发出各种控制命令，称为**微命令**。执行部件接受微命令后所进行的操作，称为**微操作**。

相容性的微操作：在同时或同一个CPU周期内可以并行执行的微操作。

![image-20240622105708815](./05%20CPU.assets/image-20240622105708815.png)

ALU 的操作(加、减、传送)在同一个 CPU 周期中只能选择一种，不能并行，所以+，–， M(传送)三个微操作是相斥性的微操作。类似地，4、6、8 三个微操作是相斥性的，5、7、 9 三个微操作也是相斥性的。ALU 的 X 输入微操作 4、6、8 与 Y 输入的 5、7、9 这两组信号中，任意两个微操作也都是相容性的。

-   微指令：实现一定操作功能的微命令的组合
-   微程序：一条机器指令的功能是用许多条微指令组成的序列来实现的

![image-20240622105814593](./05%20CPU.assets/image-20240622105814593.png)

## 微程序控制器

-   控制存储器

    -   微指令周期：读出一条微指令并执行这条微指令的时间总和

        ![image-20240622110312030](./05%20CPU.assets/image-20240622110312030.png)

-   微指令寄存器

    -   微地址寄存器和微命令寄存器两部分

-   地址转移逻辑

    -   微指令由控制存储器读出后直接给出下一条微指令的地址，简称微地址。
    -   微程序不出现分支：下一条微指令的地址由微地址寄存器给出；
    -   微程序出现分支：即出现条件转移，通过判别测试字段P和执行部件的”状态条件“反馈信息，去修改微地址寄存器的内容，并按改好的内容去读下一条微指令。

## 微程序设计

-   微命令编码

    -   直接表示法：操作控制字段中的每一位代表一个微命令
    -   编码表示法：把一组互斥性的微命令信号组成一个小组（一个字段），然后通过字段译码器对每一个微命令信号进行译码，译码输出作为操作控制信号。
    -   混合表示法

-   微地址形成

    -   计数器方式
    -   多路转移方式：状态条件有n位，可实现微程序$2^n$路转移，涉及微地址寄存器的$n$​位。

-   微指令格式

    -   水平型微指令：一次能定义并执行多个并行操作微命令的微指令。

    -   垂直型微指令：设置微操作码字段，采用微操作码编译法，由微操作码规定微指令的功能。用较长的微程序结构换较短的微指令结构。

    -   水平型微指令与垂直型微指令的比较

        -   水平型微指令并行**操作能力强，效率高，灵活性强**

            在一条水平型微指令中，设置有控制信息传送通路(门)以及进行所有操作的微命令，因此在进行微程序设计时，可以同时定义比较多的并行操作的微命令，来控制尽可能多的
            并行信息传送，从而使水平型微指令具有效率高及灵活性强的优点。
            在一条垂直型微指令中，一般只能完成一个操作，控制一两个信息传送通路，因此微
            指令的并行操作能力低，效率低。

        -   水平型微指令**执行一条指令的时间短**
            因为水平型微指令的并行操作能力强，所以与垂直型微指令相比，可以用较少的微指
            令数来实现一条指令的功能，从而缩短了指令的执行时间。而且当执行一条微指令时，水平型微指令的微命令一般直接控制对象，而垂直型微指令要经过译码，会影响速度。

        -   由水平型微指令解释指令的微程序，有**微指令字较长而微程序短**的特点。

            垂直型微指令则相反，微指令字较短而微程序长。

        -   水平型微指令用户难以掌握，而垂直型微指令与指令比较相似，相对来说，比较容
            易掌握。

        