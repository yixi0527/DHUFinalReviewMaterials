# 选择（10分）

# 问答（20分）

1.   某机器 CPU 中有 16 个通用寄存器，运行某中断处理程序时仅用到其中 2 个寄存器，请问响应中断 而进入该中断处理程序时是否要将通用寄存器内容保存到主存中去? 需保存几个寄存器?
2.   某总线在一个总线周期中并行传送 8 字节的信息，假设一个总线周期等于一个总线时钟周期，总线时钟频率为70MHz，总线带宽是多少?
3.   说明存储器总线周期与 I/O 总线周期的异同点。
4.   程序查询、程序中断与DMA**三者信息交换特点**，其他主要区别？
5.   

# 综合（70分）

6.   (1)在中断情况下，CPU 和设备的优先级如何考虑? 请按降序排列各设备的中断优先级。

     (2)若 CPU 现执行设备 B 的中断服务程序，IM2、IM1、IM0 的状态是什么? 如果 CPU 执行设备 D 的中断服务程序，IM2、IM1、IM0 的状态又是什么?

     (3)每一级的 IM 能否对某个优先级的个别设备单独进行屏蔽? 如果不能，采取什么办 法可达到目的?

     (4)假如设备 C 一提出中断请求，CPU 立即进行响应，如何调整才能满足此要求? 

     (5)参见图 8.12(b)所示的系统，只考虑 A、B、C 三个设备组成的单级中断结 构，它要求 CPU 在执行完当前指令时对中断请求进行服务。假设：

     ​	① CPU“中断批准” 机构在响应一个新的中断之前，先要让被中断的程序的一条指令一定要执行完毕；

     ​	② $T_{DC}$为查询链中每个设备的延迟时间；

     ​	③ TA、TB、TC分别为设备 A、B、C 的服务程序所需的 执行时间；

     ​	④ TS、TR为保存现场和恢复现场所需的时间；

     ​	⑤ **主存工作周期**为TM。

     ​	试问： 就这个中断请求环境来说，系统在什么情况下达到中断饱和?

     (6)假定 CPU 取指并执行一条指令的时间为 t1，保护现场需 t2，恢复现场需 t3，中断周期需 t4，每个设备的设备服务时间为 tA，tB，…，tG。试计算只有设备 A，D，G 时的系统中断饱和时间

![7d20fcb447502a568a1ebb77ee6e875](./%E6%8A%BC%E9%A2%98%E5%8D%B7.assets/7d20fcb447502a568a1ebb77ee6e875.jpg)

# 答案

二

1.   只需要保存在中断处理程序中要用到的2个寄存器。

2.   $D_r = D \times f = 4B \times 70 \times10^6 /s = 280 MB/s$

3.   存储总线周期用于对**内存**读写；I/O总线周期对**接口中的端口**进行读写。

4.   查询：CPU与设备串行工作，传送与主程序串行工作
     中断：CPU与设备并行工作，传送与主程序串行工作
     DMA：CPU与设备并行工作，传送与主程序并行工作

     （1）程序查询、程序中断方式的数据传送主要依赖**软件**，DMA 主要依赖**硬件**。
     （2）程序查询、程序中断传送数据的基本单位为**字或字节**，DMA 为**数据块**。
     （3）程序查询方式时，CPU **主动**查询 I/O 设备状态；程序中断及 DMA 方式时CPU**被动**接受 I/O 中断请求或 DMA 请求。
     （5）程序中断方式由于软件额外开销时间比较大，因此**传输速度** **最慢**；程序查询方式软件额外开销时间基本没有，因此传输速度比中断快；DMA 方式基本由硬件实现传送，因此速度**最快**；
     注意：程序中断方式虽然 CPU 运行效率比程序查询高，但传输速度却比程序查询慢。
     （6）程序查询**接口硬件结构**最简单，因此最经济；程序中断接口硬件结构稍微复杂一些，因此较经济；DMA 控制器硬件结构最复杂，因此**成本**最高；
     （7）程序中断方式适用于**中、低速**设备的**I/O 交换**；程序查询方式适用于**中、低速** **实时处理过程**；DMA 方式适用于**高速**设备的 **I/O 交换**；

三

6.   (1)在中断情况下，CPU 的优先级最低。各设备的优先次序是：A→B→C→D→E →F→G→H→I→CPU。 

     (2)执行设备 B 的中断服务程序时 IM2IM1IM0=111；执行设备 D 的中断服务程序时， IM2IM1IM0=011。

     (3)每一级的 IM 标志不能对某个优先级的个别设备进行单独屏蔽。可将接口中的 EI(中 断允许)标志清“0”，它禁止设备发出中断请求。

     (4)要使设备 C 的中断请求及时得到响应，可将设备 C 从第 2 级取出来，单独放在第 3 级上，构成一个三级IR。使第 3 级的优先级最高，即令 IM3=0 即可。

     (5)假设取指并执行一条指令的时间也为 TM。如果三个设备同时发出中断请求，那么依次分别处理设备A、设备B、设备C的时间如下：
     $$
     t_A = 2T_M + T_{DC} + T_S + T_A + T_R\\t_B = 2T_M+2T_{DC}+T_S+T_B+T_R\\t_C=2T_M+3T_{DC}+T_S+T_C+T_R
     $$
     主存工作时间+取指并执行+延迟+保存+中断服务+恢复（？？）

     处理三个设备所需的总时间为 $T = t_A + t_B + t_c$。T 是达到中断饱和的最小时间，即中断极限频率为 $f = 1/T$

     (6)$t_A = t_4 + t_1 + t_2 + t_A + t_3;t_B = t_4 + t_1 + t_2 + t_B + t_3;t_C = t_4 + t_1 + t_2 + t_C + t_3$。

     $T = t_A + t_B + t_C$

     主存工作时间（中断周期）+取指并执行+保存+中断服务+恢复（？？）