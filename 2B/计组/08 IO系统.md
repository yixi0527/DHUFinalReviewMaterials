# CPU与I/O接口之间的数据传送

## 无条件传送方式

假设外设始终处于就绪状态。CPU直接执行I/O指令进行数据传送。

只有当接口与外设之间采用无条件传送方式时，CPU与接口之间才能采用无条件传送方式。

## 程序查询（轮询）方式

CPU通过接口对目标设备的状态进行查询：

-   外设已准备好传送数据：进行数据传送

-   外设未准备好传送数据：CPU不断地查询并等待，直到外设准备好信息交互。

-   CPU希望从外设接收一个字

    通过状态口询问外设的状态。

    如果外设的状态标识表明设备已“准备就绪”，那么CPU就从总线上接收数据；CPU在接收数据以后，通过接口发出输入响应信号，告诉外设已经把数据总线上的数据取走；然后，外设把“准备就绪”状态标志复位，并准备下一个字的交换。

    如果外设没有“准备就绪”，那么它就发出“忙”的标志，于是CPU进入循环程序等待，并在每次循环中询问外设的状态，直到“准备就绪”

-   CPU发送数据

    外设通过接口发出请求输出的信号，而后CPU询问外设是否准备就绪。如果外设已准备就绪，CPU便发出准备就绪信号，并送出数据。外设接收数据以后，向CPU发出“数据已取走”通知。

-   CPU的操作和外围设备的操作能够同步，而且软硬件的结构比较简单

-   外围设备通常动作很慢，程序进入查询循环时将白白消耗掉CPU很多时间。

## 程序中断方式

外围设备主动通知CPU，准备送出输入数据或接收输出数据的一种方法。当一个中断发生时，CPU暂停其现行程序，而转向中断处理程序，从而可以输入或输出一个数据。当中断处理完毕后，CPU返回到原来执行的任务，从其停止的地方开始执行程序。

-   节省了CPU的时间
-   适用于随机出现的服务请求
-   一旦提出要求，能使服务请求立即得到相应。
-   适合于计算机工作量十分饱满、I/O处理的实时性要求很高的系统。
-   硬件结构复杂、软件复杂度提高、服务开销时间较大。

-   中断服务程序的最后必须有两条指令，即开中断指令和中断返回指令

### 中断服务程序入口地址的获取

-   向量中断

    CPU 响应中断后，由中断机构 自动将相应中断源的中断向量地址送入 CPU，由其指明中断 服务程序入口地址并实现程序切换的中断方式。

    系统中所有的中断向量都按顺序存放在内存指定位置的一张**中断向量表**中，当CPU识别出某中断源时， 由硬件直接**产生一个与该中断源对应的中断向量地址**，以便能快速在中断向量表中找到并转入中断服务程序入口。

-   查询中断

    硬件不直接供中断服务程序的入口地址，而是为所有中断服务程序安排一个公共的中断服务程序，由公共的中断服务程 序软件查询中断源，并跳转至相应中断服务子程序入口执行。

    ![image-20240622135234910](./08%20IO%E7%B3%BB%E7%BB%9F.assets/image-20240622135234910.png)